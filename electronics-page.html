<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./electronics-page.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Electronics page</title>
</head>
<style>
</style>
<body>

    <div class="container">

          <!-- menu list -->
                 
        <div class="list-menu">
            <span class="material-symbols-outlined close-list">
                close
            </span>
            <div class="categoriesIntoMenu">
                <a href="index.html">Home</a>
                <a href="men-page.html">Men</a>
                <a href="women-page.html">Women</a>
                <a href="electronics-page.html">Electronics</a>
            </div>
            <div class="information">
                <div class="myAccount">
                    <a href="">
                        <span class="material-symbols-outlined">
                            person
                        </span>
                    </a>
                    Profile
                </div>
                <div class="favoritePageIntoMenu">
                    <a href="fav-page.html">
                        <span class="material-symbols-outlined ">
                            favorite
                        </span>
                    </a>
                    Favorite page
                </div>
                
            </div>
        </div>
                <!-- header -->

        <header class="header">

            <div class="menu">
                <span class="material-symbols-outlined">
                    menu
                </span>
            </div>
            <div class="categories">
                categories
                <span class="material-symbols-outlined">
                    arrow_drop_down
                </span>
                <div class="individualCategorie">
                    <a href="index.html">Home</a>
                    <a href="men-page.html">Men</a>
                    <a href="women-page.html">Women</a>
                    <a href="electronics-page.html">Electronics</a>
                </div>
            </div>

            <div class="search-bar">
                <input type="text" id="searchInput" onkeyup="search()" class="input" placeholder="search..." >
                <span class="material-symbols-outlined styleIcon">
                    search
                </span>
            </div>

            <div class="cart">

                <div class="change-color">
                    <!--? custom input checkbox for change color page -->
                    <input type="checkbox" id="custom-input">
                </div>
                <div class="myAccount">
                    <a href="">
                        <span class="material-symbols-outlined">
                            person
                        </span>
                    </a>
                </div>
                <div class="favorite-page ">
                    <a class="" href="fav-page.html">
                        <span class="material-symbols-outlined">
                            favorite
                        </span>
                        <div class="countTheProducts"></div>
                    </a>
                    <div class="header-fav"></div>
                </div>

                <div class="shopping">
                    <a href="shopping-page.html">
                        <span class="material-symbols-outlined style-cart" >
                            shopping_cart
                        </span>
                        <div class="countTheProductsShop"></div>
                    </a>
                </div>

            </div>
        </header>

        <div class="products">
            <div class="header-title">Electronic products</div>
            <div class="all-product"></div>
        </div>
    </div>



    <script >
        let favArrFromHome =  JSON.parse(localStorage.getItem('favArrFromHome')) || []
        let addFromHome =  JSON.parse(localStorage.getItem('addFromHome')) || []
        let listProduct = []
        let allProduct = document.querySelector(".all-product")
        
        fetch("https://fakestoreapi.com/products")
        .then(response => response.json())
        .then(data => {
        listProduct = data    
        
        listProduct.filter((ele, index)=> {
            if (ele.category == "electronics") {
                allProduct.innerHTML += 

            `
               <div class="product" id="${++index}">
                    <img class="fav" src="https://cf-vectorizer-live.s3.amazonaws.com/vectorized/2k3ibr2cemKXwpYV9ZlXxHVr2Ab/2k3ik53QXe73xFDcEtT64b46vX9.svg">
                    <a class="newProduct" href="singlePro.html?id=${ele.id}">
                        <div class="main-image">
                            <img class="image" src="${ele.image}" alt="">
                        </div>
                        <div class="description">${ele.title.split(' ').slice(0,6).join(" ")}</div>
                    </a>
                    <div class="star-rating">
                        <span class="material-symbols-outlined fixedFontSize">
                            star
                        </span>
                        <span class="material-symbols-outlined fixedFontSize">
                            star
                        </span>
                        <span class="material-symbols-outlined fixedFontSize">
                            star
                        </span>
                        <span class="material-symbols-outlined fixedFontSize">
                            star
                        </span>
                        <span class="material-symbols-outlined fixedFontSize">
                            star
                        </span>
                    </div>
                    <div class="priceANDbutton">
                        <div class="priceOfPiece">$${ele.price}</div>
                        <button class="addButton">
                            Add to cart
                        </button>
                    </div>
                </div>    
                `
            }

            })   
            
            function rating() {

                listProduct.forEach((element, index) => {
                    
                    let rating = Math.round(element.rating.rate);  // Round the rating for each product
                    let productElement = document.querySelectorAll(".product")[index];  // Select the specific product container
                    let stars = productElement.querySelectorAll(".star-rating span");  // Get stars for that specific product
                
                    if (stars.length > 0) {  // Check if stars exist
                        for (let i = 0; i < rating; i++) {
                            if (stars[i]) {
                                stars[i].classList.add("checked");
                            }else {
                                stars[i].classList.add("changeColorMode");   
                            }
                        }
                    } 
                });
            }
            rating()

        })  
        // search bar
        
        function search() {
            let searchInput = document.getElementById('searchInput').value.toUpperCase()
            let product = document.querySelectorAll(".product")
            let productName = document.getElementsByTagName("h2")
        
            for (let i = 0; i < productName.length; i++) {
                if (productName[i].innerHTML.toUpperCase().indexOf(searchInput) >= 0) {
                    product[i].style.display = ""
                }else {
                    product[i].style.display = "none"
                }    
            }    
        }  

        // change heart when click on it and send to favorite page. 

        setTimeout(() => {
            let favs = document.querySelectorAll(".fav")
            favs.forEach((fav) => {
                fav.addEventListener("click", function addToFavorite(e) {
                    if (e.currentTarget.src = "https://cf-vectorizer-live.s3.amazonaws.com/vectorized/2k3ibr2cemKXwpYV9ZlXxHVr2Ab/2k3ik53QXe73xFDcEtT64b46vX9.svg") {
                        e.currentTarget.src = "https://i.ibb.co/S5nQtT8/free-heart-icon-431-thumb-removebg-preview.png"
                        let elem = {
                            img:e.currentTarget.parentElement.children[1].children[0].children[0].src,
                            id: e.currentTarget.parentElement.id,
                            title: e.currentTarget.parentElement.children[1].children[1].textContent,
                            price: e.currentTarget.parentElement.children[3].children[0].textContent,
                            rating: e.currentTarget.parentElement.parentElement.children[2].dataset.rating
                        }
                        favArrFromHome.push(elem)
                    }
                    localStorage.setItem('favArrFromHome', JSON.stringify(favArrFromHome)) 
                    countFavProducts()
                })  
        
            })
            
            let btn = document.querySelectorAll('.addButton')
            btn.forEach((item)=> {
                item.addEventListener('click' ,  function() {addProductToCart(item)})
            })
        }, 1000);

        // Add product for shopping page  

        function addProductToCart(item) {
            let element = {
                img: item.parentElement.parentElement.children[1].children[0].children[0].src,
                id: item.parentElement.parentElement.id,
                title: item.parentElement.parentElement.children[1].children[1].textContent,
                price: item.parentElement.children[0].textContent,
            }
            addFromHome.push(element)
            localStorage.setItem('addFromHome', JSON.stringify(addFromHome)) 
            countFavProducts()
        }

       //! menu list 
        document.querySelector('.menu').addEventListener("click", () => {    
            document.querySelector('.list-menu').style.display = "flex"
        })
        document.querySelector('.close-list').addEventListener("click", () => {
            document.querySelector('.list-menu').style.display = "none"
        })

        //! when add new product to fav => show like alert
        countFavProducts()
        function countFavProducts() {
            if (!favArrFromHome.length == 0 &&!addFromHome.length == 0 ) {
                let countTheProductsFAv = document.querySelector(".countTheProducts")
                let countTheProductsShop = document.querySelector(".countTheProductsShop")
                console.log(countTheProductsFAv)
                countTheProductsFAv.textContent = `${favArrFromHome.length}`
                countTheProductsShop.textContent = `${addFromHome.length}`

            }
        }
        
        //! make the header fixed => (hide on scroll, show on scroll up)
        let lastScrollTop = 0;
        const header = document.querySelector("header");

        window.addEventListener("scroll", function() {
        let currentScroll = window.pageYOffset || document.documentElement.scrollTop;

        if (currentScroll > lastScrollTop) {
            header.style.top = "-80px"; 
        } else {
            header.style.top = "20px";
        }
        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll; 
        });
    </script>
</body>
</html>